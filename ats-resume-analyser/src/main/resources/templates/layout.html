<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${pageTitle} ?: 'ATS Resume Analyser'">ATS Resume Analyser</title>
    <link rel="icon" type="image/png" th:href="@{/images/favicon.png}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script>
      (function() {
        var theme = localStorage.getItem('theme');
        if (theme === 'dark') {
          document.documentElement.classList.add('dark-mode');
        }
      })();
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa; 
            color: #212529; 
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
            transition: background-color 0.3s ease;
        }
        .main-container {
            padding-top: 2rem;
            padding-bottom: 4rem;
            position: relative;
            z-index: 2;
        }
        .content-card {
            background: #ffffff;
            border-radius: 0.75rem;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,.05);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .btn-primary {
             background-color: #0d6efd;
             border: none;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
        }
        .header-image {
            max-width: 400px;
            height: auto;
            margin-bottom: 2rem;
        }
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            transition: opacity 0.3s ease;
        }
        .animated-shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(123, 47, 247, 0.08); 
            animation: floatShape 15s ease-in-out infinite;
        }
        @keyframes floatShape {
            0% { transform: translateY(0px) scale(1); opacity: 0.8; }
            50% { transform: translateY(-120px) scale(1.2); opacity: 1; }
            100% { transform: translateY(0px) scale(1); opacity: 0.8; }
        }
        .score-card {
            background: #f5f7ff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: background-color 0.3s ease;
        }
        .progress-bar {
            font-weight: 600;
        }
        
        /* Dark Mode Styles */
        html.dark-mode body {
          background-color: #121212;
          color: #e0e0e0;
        }
        html.dark-mode .navbar {
          background-color: #1e1e1e !important;
          box-shadow: 0 2px 4px rgba(0,0,0,.3);
          border-bottom: 1px solid #333;
        }
        html.dark-mode .navbar-brand,
        html.dark-mode .nav-link {
          color: #ffffff !important;
        }
        html.dark-mode .content-card {
          background: #1e1e1e;
          border: 1px solid #333;
          box-shadow: 0 4px 12px rgba(0,0,0,.2);
        }
        html.dark-mode h1,
        html.dark-mode h2,
        html.dark-mode h3,
        html.dark-mode h4,
        html.dark-mode h5,
        html.dark-mode h6,
        html.dark-mode .text-dark,
        html.dark-mode .accordion-button {
          color: #ffffff !important;
        }
        html.dark-mode .accordion-button::after {
          filter: invert(1) grayscale(100) brightness(200%);
        }
        html.dark-mode .text-muted {
          color: #a0a0b0 !important;
        }
        html.dark-mode .score-card,
        html.dark-mode .ai-report-box,
        html.dark-mode .bg-light-subtle {
          background-color: #2a2a2a !important;
        }
        html.dark-mode .bg-warning-subtle {
          background-color: #4d3800 !important;
          color: #ffefb3 !important;
        }
        html.dark-mode .form-control,
        html.dark-mode .form-select {
            background-color: #2a2a2a;
            color: #ffffff;
            border-color: #444;
        }
        html.dark-mode .animated-background {
            opacity: 0;
        }
        html.dark-mode #theme-icon-sun {
          display: inline-block;
        }
        html.dark-mode #theme-icon-moon {
          display: none;
        }
        html:not(.dark-mode) #theme-icon-sun {
          display: none;
        }
        html:not(.dark-mode) #theme-icon-moon {
          display: inline-block;
        }
    </style>
</head>
<body>

    <div class="animated-background">
      </div>

    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" th:href="@{/}">
                <i class="bi bi-file-earmark-person-fill"></i>
                ATS Analyser
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/}"><i class="bi bi-magic"></i> New Analysis</a>
                    </li>
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link" th:href="@{/history}"><i class="bi bi-clock-history"></i> My History</a>
                    </li>
                    <li class="nav-item ms-lg-2">
                        <a class="nav-link" href="#" id="theme-toggle" style="cursor: pointer;">
                            <i class="bi bi-moon-fill" id="theme-icon-moon"></i>
                            <i class="bi bi-sun-fill" id="theme-icon-sun"></i>
                        </a>
                    </li>
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <form th:action="@{/logout}" method="post" class="d-flex">
                            <button type="submit" class="nav-link btn btn-link"><i class="bi bi-box-arrow-right"></i> Logout</button>
                        </form>
                    </li>
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-link" th:href="@{/login}">Login</a>
                    </li>
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-link btn btn-primary text-white px-3" th:href="@{/register}">Sign Up</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container container">
        <div layout:fragment="content">
            </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('theme-toggle');
            const html = document.documentElement; // The <html> tag

            if (toggle) {
                toggle.addEventListener('click', function(e) {
                  e.preventDefault();
                  if (html.classList.contains('dark-mode')) {
                    html.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                  } else {
                    html.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                  }
                });
            }
        });
    </script>
    
    <th:block layout:fragment="scripts">
    </th:block>

</body>
</html>